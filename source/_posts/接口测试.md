---
title: 接口测试
date: 2019-10-07 12:25:30
tags:  [接口测试,Yapi]
categories: Yapi
toc: true
---
[TOC]


## 如何写接口测试用例？

```PYTHON
接口测试用例可分为混合场景测试用例和单个接口测试用例

写测试用例之前需要先进行场景设计，模拟用户的实际操作，不知道的接口或参数可以直接用charles抓包解决；
写接口测试用例首先看接口文档，看接口文档（swagger）涉及到哪写方面,j接着在石墨上根据着几个大点进行细分
```

## 接口测试的概念？

```PYTHON
绕过前端，直接对后端的功能进行测试
```

## 接口测试的流程?

```PYTHON
1. 需求文档和接口文档
2.编写测试用例 设计测试数据
3.执行测试
    - 定位接口资源
    - 提交请求数据
    - 验证返回结果
```

## 接口测试的作用？

```PYTHON
1. 精准定位BUG
2. 发现程序中的安全隐患 
3. 提高测试效率
```

## 接口测试的测试点？

```PYTHON
1.功能测试
	业务流程测试：正向场景逆向场景
    特殊字符
    参数类型
    参数有/无/null
    所有必选参数
   	组合可选参数
    边界值测试等等
2.性能测试
	响应时间
	吞吐量
	并发数等等
3.安全测试
	敏感信息是否加密
	必要参数是否后端校验
	接口是否防恶意请求等等
```

## 接口测试的用例如何写？

```PYTHON
包含以下部分：ID,模块，接口名称，请求URL，用例名称，前置条件，请求类型，请求类型，请求参数类型，请求参数，预期结果，实际结果，备注
最好用EXCEL写
```

##接口测试的分类

```PYTHON
1.WEB接口测试(BS架构的)

服务器接口测试 : 公司内部系统使用的接口
第三方接口测试(外部接口测试):调用其他公司开发的接口，比如:天气预报 支付宝支付接口，微信支付接口

2.模块接口测试(CS架构的)

比如:QQ 等等
```

## restful架构风格

```PYTHON
作用：提高文档的易读性
三要素：
1.URL和请求方式
URL(统一资源定位符) http://127.0.0.1:8000/api/departments/
http = 访问协议， https ftp ftps
127.0.0.1 = 服务器的ip 通过ip地址找到服务器
8000 = 端口号 通过端口号 找到应用程序 
/api/departments/ = 资源路径 找到应用程序的功能模块

常见的请求方式: GET POST PUT DELETE 对应的 查 增 改 删
2.提交数据格式
两种格式:
格式1
键值对: username=huluwa&passowrd=jiuyeye&aihao=tuhuo&aihao=tushui 
格式2
JSON格式:
{"username":"huluwa", "password":"jiuyeye", "aihao":["tuhuo","tushui","yinshen"]}
3.查看响应结果
两大关注点: 
1. 状态码:
2XX 请求成功， 200 201新增成功 204 删除成功
3XX 资源重定向 ， 302请求重定向， 304 读取缓存
4XX 浏览器端异常 ， 404URL地址错误 比如 有空格 或者 字母写错了 
5XX 服务器端异常， 500 服务器挂了
2. 响应体: 
HTML格式数据
JSON格式的数据
```

## 接口测试工具:Postman

### 安装

```PYTHON
点击网址：https://www.getpostman.com/apps，直接点击下一步就行
```

### 使用

```PYTHON
简单的使用方法：点击页面上方的+，选择请求方式，输入URL，点击send即可；
```

##接口测试工具：Yapi

###特点：

```python
1.基于Json5和Mockjs定义接口返回数据的结构和文档，效率提升多倍

2.扁平化权限设计，既保证了大型企业级项目的管理，又保证了易用性

3.类似postman的接口调试

4.自动化测试，支持对response断言

5.MockServer除支持普通的随机mock外，还增加了Mock期望功能，根据设置的请求过滤规则，返回期望数据

6.支持postman，har,swagger数据导入

7.免费开源，内部部署，信息再也不怕泄漏

```

###Yapi的使用文档

测试集合-动态（查看项目的操作日志）；-设置（项目组长可以编辑项目信息）；-成员管理（可以添加成员）

新建一个接口分三步：获取权限，找到一个项目，新建接口

如果在项目列表中找不到自己想要的项目,可以联系项目组长，把自己添加到项目中

**1.创建分组**只有超级管理员可以创建分组

**2.创建项目**分组成员可创建项目（不是成员可联系分组组长）；项目名称不能重复，包括其他分组；基本路径为接口统一添加了前缀

1.修改项目（点开项目-项目列表详情页-设置-可修改项目头像和图标/将项目迁移到不同分组内）

2.复制项目（鼠标放到项目上，左上角有一个复制按钮）

3.删除项目（进入项目-设置-项目设置-危险操作-查看）

**3.Yapi使用时需要安装Cross-request插件**

Yapi测试使用流程

```python
创建分组（个人空间旁边的+号）-创建项目（点击头像旁边的+号/添加项目按钮）-设置（swagger自动同步-创建测试结合，导入接口,自动更新swagger接口数据到Yapi平台）-新建测试结合-新建接口（上一个接口里的参数或返回值作为下一个接口的参数时，.{key}.{params|body}.{path}-其中 ，. 是使用 动态变量 的标志，.269.params 即表示 key 值为 269 用例的请求参数，.269.body 即表示 key 值为 269 用例的返回值。）
```



###Yapi的介绍

1.人员组成：超级管理员（创建组长，分配组长，管理所有成员信息），组长（创建项目，管理分组或项目信息，管理开发着雨成员），开发者/成员（不允许创建分组，不允许修改分组或项目信息）

组长一般是由项目组长或BU负责人担任（BU是英文business unit的缩写,BU manager --业务单元管理!）

组长分为：分组组长（修改/删除/创建分组下的项目，分组组长只需要对项目负责，将项目的操作任务安排给项目组长）和项目组长（只属于某一个项目无法操作项目所属分组，是Yapi的基础管理者）

在每个项目中将服务端开发者设置为项目组长权限，客户端开发者设置为开发者权限

```python
Yapi只需要配置相关的参数和断言语句，就能实现自动化测试
```

###Yapi中一个接口的返回结果作为下一个接口的请求参数该如何设置？



```python
设置-开启json5/开启消息通知(query-返回数据开启)

设置-环境配置-global（全局变量，接口运行或测试集合中可以通过{{global.全局变量名}}）来访问当前环境变量下定义的全局变量
**请求配置：**
请求参数处理脚本(根据confluence中的HTTPheader来写)
context.requestHeader.nonce= context.utils.md5(`${context.hostname}-${storage.getItem("userId")}-${Date.now()}`)
context.requestHeader.version="1.2.0"
context.requestHeader.channel="BE83628C-4A99-4F2F-B26F-AC828D591908"
context.requestHeader.platform="iOS"
context.requestHeader.deviceInfo="model=iPhone10,3&os=iOS 12.2&size=1125x2436&net=unknown"
if(context.pathname!="/yiban-app/api/user/v1.0.0/getCheckcode"){
    context.requestHeader.token=storage.getItem("token")
    context.requestHeader.userId=storage.getItem("userId")）
响应数据处理脚本
（if(context.pathname=="/yiban-app/api/user/v1.0.0/getCheckcode"){
    storage.setItem('token', context.responseData.data.token)
    storage.setItem('userId', context.responseData.data.userVo.userId)）
注意：这个根据公司wiki上的请求头来规范来定
```

#### 断言？

```python

assert.equal(body.code, 200)
//心愿id数组
list_1 = body.data.othersTeamWish.map(item=>item.partnerWishId)
//对心愿id数组作降序
list_2 = body.data.othersTeamWish.map(item=>item.partnerWishId).sort(function(a, b){return b - a})
//默认的待认领列表按时间降序排列，如果list_1有list_2相同，则排序正确
assert.deepEqual(list_1, list_2)
```

#### 终端中请求mock地址?

```python
curl -X post ‘mock地址’ | jq ‘.’
```

**接口用例设计主要是参数校验，功能校验、业务场景校验、安全性及性能校验**